<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Biorbd: BIORBD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Biorbd
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">BIORBD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BIORBD is a library to analyze biomechanical data. It provides several useful functions for the direct and inverse flow including rigid body (based on <em>Feathestone</em> equations implemented in RBDL) and muscle elements.</p>
<p>Biomechanical data are often analyzed using similar flow, that is inverse or direct. BIORBD implements these common analyses providing high-level and easy to use Python and MATLAB interfaces of an efficient C++ implementation.</p>
<p>So, without further ado, let's begin our investigation of BIORBD!</p>
<h1><a class="anchor" id="autotoc_md1"></a>
How to install</h1>
<p>There are two main ways to install BIORBD on your computer: installing the binaries from Anaconda (easiest, but limited to C++ and Python3) or compiling the source code yourself (more versatile and up to date; for C++, Python3 and MATLAB).</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Anaconda (For Windows, Linux and Mac)</h2>
<p>The easiest way to install BIORBD is to download the binaries from Anaconda (<a href="https://anaconda.org/">https://anaconda.org/</a>) repositories (binaries are not available though for MATLAB). The project is hosted on the conda-forge channel (<a href="https://anaconda.org/conda-forge/biorbd">https://anaconda.org/conda-forge/biorbd</a>).</p>
<p>After having installed properly an anaconda client [my suggestion would be Miniconda (<a href="https://conda.io/miniconda.html">https://conda.io/miniconda.html</a>)] and loaded the desired environment to install BIORBD in, just type the following command: </p><div class="fragment"><div class="line">conda install -c conda-forge biorbd</div>
</div><!-- fragment --><p> The binaries and includes of the core of BIORBD will be installed in <code>bin</code> and <code>include</code> folders of the environment respectively. Moreover, the Python3 binder will also be installed in the environment.</p>
<p>The current building status for Anaconda release is as follow.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Downloads  </th><th class="markdownTableHeadNone">Version  </th><th class="markdownTableHeadNone">Platforms   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://anaconda.org/conda-forge/biorbd"><img src="https://img.shields.io/badge/recipe-biorbd-green.svg" alt="Conda Recipe" class="inline"/></a>  </td><td class="markdownTableBodyNone"><a href="https://anaconda.org/conda-forge/biorbd"><img src="https://img.shields.io/conda/dn/conda-forge/biorbd.svg" alt="Conda Downloads" class="inline"/></a>  </td><td class="markdownTableBodyNone"><a href="https://anaconda.org/conda-forge/biorbd"><img src="https://img.shields.io/conda/vn/conda-forge/biorbd.svg" alt="Conda Version" class="inline"/></a>  </td><td class="markdownTableBodyNone"><a href="https://anaconda.org/conda-forge/biorbd"><img src="https://img.shields.io/conda/pn/conda-forge/biorbd.svg" alt="Conda Platforms" class="inline"/></a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md3"></a>
Compiling (For Windows, Linux and Mac)</h2>
<p>The main drawback with downloading the pre-compiled version from Anaconda is that this version may be out-of-date (even if I do my best to keep the release versions up-to-date). Moreover, since it is already compiled, it doesn't allow you to modify BIORBD if you need to. Therefore, a more versatile way to enjoy BIORBD is to compile it by yourself.</p>
<p>The building status for the current BIORBD branches is as follow</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">master  </td><td class="markdownTableBodyNone"><a href="https://travis-ci.org/pyomeca/biorbd"><img src="https://travis-ci.org/pyomeca/biorbd.svg?branch=master" alt="Build Status" class="inline"/></a>   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md4"></a>
Dependencies</h3>
<p>BIORBD relies on several libraries (namely Boost (<a href="https://www.boost.org/">https://www.boost.org/</a>), eigen (<a href="http://eigen.tuxfamily.org">http://eigen.tuxfamily.org</a>), dlib (<a href="http://dlib.net/">http://dlib.net/</a>), rbdl (<a href="https://rbdl.bitbucket.io/">https://rbdl.bitbucket.io/</a>) and Ipopt (<a href="https://github.com/coin-or/Ipopt">https://github.com/coin-or/Ipopt</a>)) that one must install prior to compiling. Fortunately, all these dependencies are also hosted on the <em>conda-forge</em> channel of Anaconda. Therefore the following command will install everything you need to compile BIORBD: </p><div class="fragment"><div class="line">conda install -c conda-forge boost eigen dlib-cpp rbdl ipopt</div>
</div><!-- fragment --><p> Please note that <code>ipopt</code> is optional, but is required for the <em>Static optimization</em> module.</p>
<p>Additionnally, for the Python3 interface requires <em>numpy</em> (<a href="https://numpy.org/">https://numpy.org/</a>) and <em>SWIG</em> (<a href="http://www.swig.org/">http://www.swig.org/</a>). Again, one can easily install these dependencies from Anaconda using the following command: </p><div class="fragment"><div class="line">conda install -c conda-forge numpy swig</div>
</div><!-- fragment --><p>Finally, the MATLAB interface (indeed) requires MATLAB to be installed.</p>
<p>If ones is interested in developping BIORBD, the <code>googletest</code> suite is required to test your modifications. Fortunately, the CMake should download and compile the test suite for you!</p>
<h3><a class="anchor" id="autotoc_md5"></a>
CMake</h3>
<p>BIORBD comes with a CMake (<a href="https://cmake.org/">https://cmake.org/</a>) project. If you don't know how to use CMake, you will find many examples on Internet. The main variables to set are:</p>
<blockquote class="doxtable">
<p><code>CMAKE_INSTALL_PREFIX</code> Which is the <code>path/to/install</code> BIORBD in. If you compile the Python3 binder, a valid installation of Python with Numpy should be installed relatived to this path.</p>
<p><code>BUILD_SHARED_LIBS</code> If you wan to build BIORBD in a shared <code>TRUE</code> or static <code>FALSE</code> library manner. Default is <code>TRUE</code>. Please note that due to the dependencies, on Windows BIORBD must be statically built.</p>
<p><code>CMAKE_BUILD_TYPE</code> Which type of build you want. Options are <code>Debug</code>, <code>RelWithDebInfo</code>, <code>MinSizeRel</code> or <code>Release</code>. This is relevant only for the build done using the <code>make</code> command. Please note that you will experience a slow BIORBD library if you compile it without any optimization (i.e. <code>Debug</code>), especially for all functions that requires linear algebra.</p>
<p><code>BUILD_EXAMPLE</code> If you want (<code>TRUE</code>) or not (<code>FALSE</code>) to build the C++ example. Default is <code>TRUE</code>.</p>
<p><code>BUILD_TESTS</code> If you want (<code>ON</code>) or not (<code>OFF</code>) to build the tests of the project. Please note that this will automatically download gtest (<a href="https://github.com/google/googletest">https://github.com/google/googletest</a>). Default is <code>OFF</code>.</p>
<p><code>BUILD_DOC</code> If you want (<code>ON</code>) or not (<code>OFF</code>) to build the documentation of the project. Default is <code>OFF</code>.</p>
<p><code>BINDER_PYTHON3</code> If you want (<code>ON</code>) or not (<code>OFF</code>) to build the Python binder. Default is <code>OFF</code>.</p>
<p><code>Python3_EXECUTABLE</code> If <code>BINDER_PYTHON3</code> is set to <code>ON</code> then this variable should point to the Python executable. This python should have <em>SWIG</em> and <em>Numpy</em> installed with it. This variable should be found automatically, but Anaconda finds the base prior to the actual environment, so one should gives attention to that particular variable.</p>
<p><code>SWIG_EXECUTABLE</code> If <code>BINDER_PYTHON3</code> is set to <code>ON</code> then this variable should point to the SWIG executable. This variable will be found automatically if <code>Python3_EXECUTABLE</code> is properly set.</p>
<p><code>BINDER_MATLAB</code> If you want (<code>ON</code>) or not (<code>OFF</code>) to build the MATLAB binder. Default is <code>OFF</code>.</p>
<p><code>MATLAB_ROOT_DIR</code> If <code>BINDER_MATLAB</code> is set to <code>ON</code> then this variable should point to the root path of MATLAB directory. Please note that the MATLAB binder is based on MATLAB R2018a API and won't compile on earlier versions. This variable should be found automatically, except on Mac where the value should manually be set to the MATLAB in the App folder.</p>
<p><code>MATLAB_biorbd_INSTALL_DIR</code> If <code>BINDER_MATLAB</code> is set to <code>ON</code> then this variable should point to the path where you want to install BIORBD. Typically, this is <code>{MY DOCUMENTS}/MATLAB</code>. The default value is the toolbox folder of MATLAB. Please note that if you leave the default value, you will probably need to grant administrator rights to the installer. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md6"></a>
How to use</h1>
<p>BIORBD provides as much as possible explicit names for the filter so one can intuitively find what he wants from the library. Still, this is a C++ library and it can be sometimes hard to find what you need. Due to the varity of functions implemented in the library, minimal examples are shown here. One is encourage to have a look at the <code>example</code> and <code>test</code> folders to get a better overview of the possibility of the API. For an in-depth detail of the API, the Doxygen documentation (to come) is the way to go.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
The C++ API</h2>
<p>The core code is written in C++, meaning that you can fully use BIORBD from C++. Moreover, the linear algebra is using the Eigen library which makes it fairly easy to perform further computation and analyses. The informations that follows is a basic guide that should allow you to perform everything you want to do.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Create an empty yet valid model</h3>
<p>To create a new valid yet empty model, just call the <code><a class="el" href="classbiorbd_1_1Model.html" title="The actual musculoskeletal model that holds everything in biorbd.">biorbd::Model</a></code> class without parameter. </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;biorbd.h&quot;</div>
<div class="line">int main()</div>
<div class="line">{</div>
<div class="line">    biorbd::Model myModel;</div>
<div class="line">}</div>
</div><!-- fragment --><p> This model can thereafter be populated using the <em>biorbd</em> add methods. Even if this is not the prefered way of loading a model, one can have a look at the <em><a class="el" href="ModelReader_8cpp_source.html">src/ModelReader.cpp</a></em> in order to know what functions that must be called to populate the model manually.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Read and write a bioMod file</h3>
<p>The prefered method to load a model is to read the in-house *.bioMod* format file. To do so, one must simply call the <code><a class="el" href="classbiorbd_1_1Model.html" title="The actual musculoskeletal model that holds everything in biorbd.">biorbd::Model</a></code> constructur with a valid path to the model. Afterward, one can modify manually the model and write it back to a new file. </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;biorbd.h&quot;</div>
<div class="line">int main()</div>
<div class="line">{</div>
<div class="line">    biorbd::Model myModel myModel(&quot;path/to/mymodel.bioMod&quot;);</div>
<div class="line">    // Do some changes...</div>
<div class="line">    biorbd::Writer::writeModel(myModel, &quot;path/to/newFile.bioMod&quot;);</div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Please note that on Windows, the path must be <code>/</code> or <code>\\</code> separated (and not only<code>\</code>), for obvious reasons.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Perform some analyses</h3>
<p>BIORBD is made to work with the RBDL functions (the doc can be found here <a href="https://rbdl.bitbucket.io/">https://rbdl.bitbucket.io/</a>). Therefore, every functions available in RBDL is also available on BIORBD. Additionnal are of course also made available, for example the whole muscle module.</p>
<p>The most obvious and probably the most used function is the forward kinematics, where one knows the configuration of the body and is interested in the resulting position of skin markers. The following code performs that task. </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;biorbd.h&quot;</div>
<div class="line">int main()</div>
<div class="line">{</div>
<div class="line">    // Load the model</div>
<div class="line">    biorbd::Model model(&quot;path/to/model.bioMod&quot;);</div>
<div class="line">    </div>
<div class="line">    // Prepare the model</div>
<div class="line">    biorbd::rigidbody::GeneralizedCoordinates Q(model); </div>
<div class="line">    Q.setOnes()/10; // Set the model position</div>
<div class="line">    </div>
<div class="line">    // Perform forward kinematics</div>
<div class="line">    std::vector&lt;biorbd::rigidbody::NodeBone&gt; markers(model.markers(Q));</div>
<div class="line">    </div>
<div class="line">    // Print the results</div>
<div class="line">    for (auto marker : markers)</div>
<div class="line">        std::cout &lt;&lt; marker.name() &lt;&lt; &quot; is at the coordinates: &quot; &lt;&lt; marker.transpose() &lt;&lt; std::endl;</div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Another common analysis to perform is to compute the effect of the muscles on the acceleration of the model. Assuming that the model that is loaded has muscles, the following code perform this task. </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;biorbd.h&quot;</div>
<div class="line">int main()</div>
<div class="line">{</div>
<div class="line">    // Load the model</div>
<div class="line">    biorbd::Model model(&quot;path/to/model.bioMod&quot;);</div>
<div class="line">    </div>
<div class="line">    // Prepare the model</div>
<div class="line">    biorbd::rigidbody::GeneralizedCoordinates Q(model), Qdot(model); // position, velocity</div>
<div class="line">    Q.setOnes()/10; // Set the model position</div>
<div class="line">    Qdot.setOnes()/10; // Set the model velocity</div>
<div class="line">    // Muscles activations</div>
<div class="line">    std::vector&lt;std::shared_ptr&lt;biorbd::muscles::StateDynamics&gt;&gt; states(model.nbMuscleTotal());</div>
<div class="line">    for (auto&amp; state : states){</div>
<div class="line">        state = std::make_shared&lt;biorbd::muscles::StateDynamics&gt;();</div>
<div class="line">        state-&gt;setActivation(0.5); // Set the muscle activation</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // Compute the joint torques based on muscle</div>
<div class="line">    biorbd::rigidbody::GeneralizedTorque muscleTorque(</div>
<div class="line">                model.muscularJointTorque(states, true, &amp;Q, &amp;Qdot));</div>
<div class="line"> </div>
<div class="line">    // Compute the acceleration of the model due to these torques</div>
<div class="line">    biorbd::rigidbody::GeneralizedCoordinates Qddot(model);</div>
<div class="line">    RigidBodyDynamics::ForwardDynamics(model, Q, Qdot, muscleTorque, Qddot);</div>
<div class="line"> </div>
<div class="line">    // Print the results</div>
<div class="line">    std::cout &lt;&lt; &quot; The joints accelerations are: &quot; &lt;&lt; Qddot.transpose() &lt;&lt; std::endl;</div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>There are many other analyses and filters that are available. Please refer to the BIORBD and RBDL Docs to see what is available.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
MATLAB</h2>
<p>MATLAB (<a href="https://www.mathworks.com/">https://www.mathworks.com/</a>) is a prototyping langage largely used in industry and fairly used by the biomechanical scientific community. Despite the existence of Octave as an open-source and very similar language or the growing popularity of Python as a free and open-source alternative, MATLAB remains an important player as a programming languages. Therefore BIORBD comes with a binder for MATLAB (that can theoretically used with Octave as well with some minor changes to the CMakeLists.txt file).</p>
<p>Most of the functions available in C++ are also available in MATLAB. Still, they were manually binded, therefore it may happen that some important one (for you) are not there. If so, do not hesitate to open an issue on GitHub to required the add of that particular function. The philosophy behind the MATLAB binder is that you open a particular model and a reference to that model is gave back to you. Thereafter, the functions can be called, assuming the pass back that model reference. That implies, however, that ones must himself deallocate the memory of the model when it is no more needed. Failing to do so results in an certain memory leak.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Perform some analyses</h3>
<p>Please find here the same tasks previously described for the C++ interface done in the MATLAB interface. Notice that the MATLAB interface takes advantage of the matrix nature of MATLAB and therefore can usually perform the analyses on multiple frames at once.</p>
<p>Forward kinematics can be performed as follow </p><div class="fragment"><div class="line">nFrames = 10; % Set the number of frames to simulate</div>
<div class="line"> </div>
<div class="line">% Load the model</div>
<div class="line">model = biorbd(&#39;new&#39;, &#39;path/to/model.bioMod&#39;);</div>
<div class="line"> </div>
<div class="line">% Prepare the model</div>
<div class="line">Q = ones(biorbd(&#39;nQ&#39;, model), nFrames)/10; % Set the model position</div>
<div class="line"> </div>
<div class="line">% Perform the forward kinematics</div>
<div class="line">markers = biorbd(&#39;markers&#39;, model, Q);</div>
<div class="line"> </div>
<div class="line">% Print the results</div>
<div class="line">disp(markers);</div>
<div class="line"> </div>
<div class="line">% Deallocate the model</div>
<div class="line">biorbd(&#39;delete&#39;, model);</div>
</div><!-- fragment --><p>The joint accelerations from muscle activations can be performed as follow </p><div class="fragment"><div class="line">nFrames = 10; % Set the number of frames to simulate</div>
<div class="line"> </div>
<div class="line">% Load the model</div>
<div class="line">model = biorbd(&#39;new&#39;, &#39;path/to/model.bioMod&#39;);</div>
<div class="line"> </div>
<div class="line">% Prepare the model</div>
<div class="line">Q = ones(biorbd(&#39;nQ&#39;, model), nFrames)/10; % Set the model position</div>
<div class="line">Qdot = ones(biorbd(&#39;nQdot&#39;, model), nFrames)/10; % Set the model velocity</div>
<div class="line">activations = ones(biorbd(&#39;nMuscles&#39;, model), nFrames)/2; % Set muscles activations</div>
<div class="line"> </div>
<div class="line">% Compute the joint torques based on muscle</div>
<div class="line">jointTorque = biorbd(&#39;jointTorqueFromActivation&#39;, model, activations, Q, Qdot);</div>
<div class="line"> </div>
<div class="line">% Compute the acceleration of the model due to these torques</div>
<div class="line">Qddot = biorbd(&#39;forwardDynamics&#39;, model, Q, Qdot, jointTorque);</div>
<div class="line"> </div>
<div class="line">% Print the results</div>
<div class="line">disp(Qddot);</div>
<div class="line"> </div>
<div class="line">% Deallocate the model</div>
<div class="line">biorbd(&#39;delete&#39;, model);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md13"></a>
Help</h3>
<p>One can print all the available functions by type the <code>help</code> command </p><div class="fragment"><div class="line">biorbd(&#39;help&#39;)</div>
</div><!-- fragment --><p> Please note that it seems that on Windows, the command returns nothing. One must therefore look in the source code (<code>biorbd/binding/matlab/Matlab_help.h</code>) what should the command have returned.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Python 3</h2>
<p>Python (<a href="https://www.python.org/">https://www.python.org/</a>) is a scripting language that has taken more and more importance over the past years. So much that now it is one of the preferred language of the scientific community. Its simplicity yet its large power to perform a large variety of tasks makes it a certainty that its popularity won't decrease for the next years.</p>
<p>To interface the C++ code with Python, SWIG is a great tool. It creates very rapidly an interface in the target language with minimal code to write. However, the resulting code in the target language can be far from being easy to use. In effect, it gives a mixed-API not far from the original C++ language, which may not comply to best practices of the target language. When this is useful to rapidly create an interface, it sometime lacks of user-friendliness and expose the user to the possibility of the C++ such as segmentation fault (unlike the MATLAB API which won't suffer from this devil problem).</p>
<p>BIORBD interfaces the C++ code using SWIG. While it has some inherent limit as discussed previously, it has the great advantage of providing almost for free the complete API. Because of that, much more of the C++ API is interfaced in Python than the MATLAB one. Again, if for some reason, part of the code which is not accessible yet is important for you, don't hesitate to open an issue asking for that particular feature!</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Perform some analyses</h3>
<p>Please find here the same tasks previously described for the C++ interface done in the Python3 interface. Please note that the interface usually takes advantage of the numpy arrays in order to interact with the user while a vector is needed.</p>
<p>Forward kinematics can be performed as follow </p><div class="fragment"><div class="line">import numpy as np</div>
<div class="line">import biorbd</div>
<div class="line"> </div>
<div class="line"># Load the model</div>
<div class="line">model = biorbd.Model(&#39;path/to/model.bioMod&#39;)</div>
<div class="line"> </div>
<div class="line"># Prepare the model</div>
<div class="line">Q = np.ones(model.nbQ())/10  # Set the model position</div>
<div class="line"> </div>
<div class="line"># Perform the forward kinematics</div>
<div class="line">markers = model.markers(Q)</div>
<div class="line"> </div>
<div class="line"># Print the results</div>
<div class="line">for marker in markers:</div>
<div class="line">    print(marker.get_array())</div>
</div><!-- fragment --><p>The joint accelerations from muscle activations can be performed as follow </p><div class="fragment"><div class="line">import numpy as np</div>
<div class="line">import biorbd</div>
<div class="line"> </div>
<div class="line"># Load the model</div>
<div class="line">model = biorbd.Model(&#39;path/to/model.bioMod&#39;)</div>
<div class="line"> </div>
<div class="line"># Prepare the model</div>
<div class="line">Q = np.ones(model.nbQ())/10  # Set the model position</div>
<div class="line">Qdot = np.ones(model.nbQ())/10  # Set the model velocity</div>
<div class="line">states = biorbd.VecBiorbdMuscleStateDynamics(model.nbMuscleTotal())</div>
<div class="line">for state in states:</div>
<div class="line">    state.setActivation(0.5)  # Set muscles activations</div>
<div class="line"> </div>
<div class="line"># Compute the joint torques based on muscle</div>
<div class="line">joint_torque = model.muscularJointTorque(states, Q, Qdot)</div>
<div class="line"> </div>
<div class="line"># Compute the acceleration of the model due to these torques</div>
<div class="line">Qddot = model.ForwardDynamics(Q, Qdot, joint_torque)</div>
<div class="line"> </div>
<div class="line"># Print the results</div>
<div class="line">print(Qddot.get_array())</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md16"></a>
Model files</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
&lt;em&gt;bioMod&lt;/em&gt; files</h2>
<p>The preferred method to load a model is by using a *.bioMod* file. This type of file is an in-house language that describes the segments of the model, their interactions and additionnal elements attached to them. The following section describe the structure of the file and all the tags that exists so far.</p>
<p>Comments can be added to the file in a C-style way, meaning that everything a on line following a <code>//</code> will be considered as a comment and everything between <code>/*</code> and <code>*/</code> will also be ignored.</p>
<p>Please note that the <em>bioMod</em> is not case dependent, so <code>Version</code>and <code>version</code> are for instance fully equivalent. The <em>bioMod</em> reader also ignore the tabulation, which is therefore only aesthetic.</p>
<p>When a tag waits for multiple values, they must be separate by a space, a tabulation or a return of line. Also, anytime a tag waits for a value, it is possible to use simple equations (assuming no spaces are used) and/or variables. For example, the following snippet is a valid way to set the gravity parameter to $(0, 0, -9.81)$. </p><div class="fragment"><div class="line">variables</div>
<div class="line">    $my_useless_variable 0</div>
<div class="line">endvariables</div>
<div class="line">gravity 2*(1-1) -2*$my_useless_variable</div>
<div class="line">        -9.81</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Header</h3>
<h4><a class="anchor" id="autotoc_md19"></a>
version</h4>
<p>The very first tag that <b>must</b> appear at the first line in file is the version of the file. The current version of the *.bioMod* files is $4$. Please note that most of the version are backward compatible, unless specified. This tag waits for $1$ value. </p><div class="fragment"><div class="line">version 4</div>
</div><!-- fragment --><p> From that point, the order of the tags is not important, header can even be at the end of the file. For simplicity though we suggest to put everything related to the header at the top of the file.</p>
<h4><a class="anchor" id="autotoc_md20"></a>
gravity</h4>
<p>The <code>gravity</code> tag is used to reorient and/or change the magnitude of the gravity. The default value is $(0, 0, -9.81)$. This tag waits for $3$ values. </p><div class="fragment"><div class="line"><span class="comment">// Restate the default value</span></div>
<div class="line">gravity 0 0 -9.81</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md21"></a>
root_actuated</h4>
<p>The <code>root_actuated</code> tag allows to change the number of non-zero degrees-of-freedom on the first segment. Typically, if the whole body is modeled, this is set to false, otherwise to true. Please note, that even if this tag is false, the <em>GeneralizedTorque</em> vector sent to <code>RigidBodyDynamic</code> must be of the same size as <em>qddot</em>. The default value is true ($1$). This tags waits for $1$ value. </p><div class="fragment"><div class="line"><span class="comment">// Restate the default value</span></div>
<div class="line">root_actuated 1</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md22"></a>
external_forces</h4>
<p>The <code>external_forces</code> tag allows to inform BIORBD that external forces exists in the model. So far, this tag has no effect. The default value is false ($0$) This tags waits for $1$ value. </p><div class="fragment"><div class="line"><span class="comment">// Restate the default value</span></div>
<div class="line">external_forces 0</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md23"></a>
variables / endvariables</h4>
<p>The <code>variables / endvariables</code> tag pair allows to declare variables that can be used within the file. This allows for example to template the <em>bioMod</em> file by only changing the values in the variables. Please note that contrary to the rest of the file, the actual variables are case dependent.</p>
<p>The <code>\$</code> sign is mandatory and later in the file, everything with that sign followed by the same name will be converted to the values specified in the tag. </p><div class="fragment"><div class="line"><span class="comment">// Restate the default value</span></div>
<div class="line">variables</div>
<div class="line">    $my_first_variable_is_an_int 10</div>
<div class="line">    $my_second_variable_is_a_double 10.1</div>
<div class="line">    $myThirdVariableIsCamelCase 1</div>
<div class="line">    $myLastVariableIsPi pi</div>
<div class="line">endvariables</div>
</div><!-- fragment --><p> As you may have noticed, the constant PI is defined as $3.141592653589793$.</p>
<h3><a class="anchor" id="autotoc_md24"></a>
Definition of the model</h3>
<p>A BIORBD model consists of a chain of segment, linked by joints with up to six DoF (3 translations, 3 rotations). It is imperative when attaching something to a segment of the model that particular segment must have been previously defined. For instance, if the <code>thorax</code> is attached to the <code>pelvis</code>, then the latter must be defined before the former in the file.</p>
<h4><a class="anchor" id="autotoc_md25"></a>
Segment</h4>
<p>The <code>segment xxx / endsegment</code>tag pair is the core of a <em>bioMod</em> file. It describes a segment of the model with the name <code>xxx</code>, that is most of the time a bone of the skeleton. For internal reasons, the name cannot be <code>root</code>. The <code>xxx</code> must be present and consists of $1$ string. The segment is composed of multiple subtags, described here.</p>
<div class="fragment"><div class="line">segment default_segment</div>
<div class="line">    parent ROOT</div>
<div class="line">    rtinmatrix 0</div>
<div class="line">    rt 0 0 0 xyz 0 0 0</div>
<div class="line">    translation xyz</div>
<div class="line">    rotations xyz</div>
<div class="line">    com 0 0 0</div>
<div class="line">    inertia </div>
<div class="line">        1 0 0</div>
<div class="line">        0 1 0</div>
<div class="line">        0 0 1</div>
<div class="line">endsegment</div>
<div class="line"> </div>
<div class="line">segment second_segment</div>
<div class="line">    parent default_segment</div>
<div class="line">endsegment</div>
</div><!-- fragment --><p><a class="anchor" id="autotoc_md26"></a></p><h5>parent</h5>
<p>The <code>parent</code> tag is the name of the segment that particular segment is attached to. If no segment parent is provided, it is considered to be attached to the environment. The parent must be defined earlier in the file and is case dependent. This tag is waits for $1$ string.</p>
<p><a class="anchor" id="autotoc_md27"></a></p><h5>rt</h5>
<p>The <code>homogeneous matrix</code> of transformation (rototranslation) of the current segment relative to its parent. If <code>rtinmatrix</code> is defined to <code>1</code>, <code>rt</code> waits for a 4 by 4 matrix (the 3 x 3 matrix of rotation and the 4th column being the translation and the last row being 0 0 0 1); if it is defined to <code>0</code> it waits for the 3 rotations, the rotation sequence and the translation. The default value is the identity matrix.</p>
<p><a class="anchor" id="autotoc_md28"></a></p><h5>rtinmatrix</h5>
<p>The tag that defines if the <code>rt</code> is in matrix or not. If the <code>version</code> of the file is higher or equal than $3$, the default value is false ($0$), otherwise, it true ($1$).</p>
<p><a class="anchor" id="autotoc_md29"></a></p><h5>translations</h5>
<p>The <code>translations</code> tag specifies the number of degrees-of-freedom in translation and their order. The possible values are <code>x</code>, <code>y</code> and/or <code>z</code> combined whatever fits the model. Please note that the vector of generalized coordinate will comply the the order wrote in this tag. If no translations are provided, then the segment has no translation relative to its parent. This tag waits for $1$ string.</p>
<p><a class="anchor" id="autotoc_md30"></a></p><h5>rotations</h5>
<p>The <code>rotations</code> tag specifies the number of degrees-of-freedom in rotation and their order. The possible values are <code>x</code>, <code>y</code> and/or <code>z</code> combined whatever fits the model. Please note that the vector of generalized coordinate will comply the the order wrote in this tag. If no rotations are provided, then the segment has no rotation relative to its parent. This tag waits for $1$ string.</p>
<p><a class="anchor" id="autotoc_md31"></a></p><h5>mass</h5>
<p>The <code>mass</code> tag specifies the mass of the segment in kilogram. This tag waits for $1$ value. The default value is $0.00001$. Please note that a pure $0$ can create a singularity.</p>
<p><a class="anchor" id="autotoc_md32"></a></p><h5>com</h5>
<p>The $3$ values position of the <code>center of mass</code> relative to the local reference of the segment. The default values are <code>0 0 0</code>.</p>
<p><a class="anchor" id="autotoc_md33"></a></p><h5>inertia</h5>
<p>The <code>inertia</code> tag allows to specify the matrix of inertia of the segment. It waits for $9$ values. The default values are the <code>identity matrix</code></p>
<p><a class="anchor" id="autotoc_md34"></a></p><h5>foreceplate</h5>
<p>When calculating the inverse dynamics, if force plates are used, this tag dispatch the force plates, the first force plate being $0$. If no force plate is acting on this segment, the value is $-1$.</p>
<p><a class="anchor" id="autotoc_md35"></a></p><h5>meshfile or ply</h5>
<p>The path of the meshing <code>.bioBone</code> or <code>.ply</code> file respectively. It can be relative to the current running folder or absolute (relative being preferred) and UNIX or Windows formatted (<code>/</code> vs <code>\\</code>, UNIX being preferred).</p>
<p><a class="anchor" id="autotoc_md36"></a></p><h5>mesh</h5>
<p>If the mesh is not written in a file, it can be written directly in the segment. If so, the <code>mesh</code> tag stands for the vertex. Therefore, there are as many <code>mesh</code> tags as vertex. It waits for $3$ values being the position relative to reference of the segment.</p>
<p><a class="anchor" id="autotoc_md37"></a></p><h5>patch</h5>
<p>The patches to define the orientation of the patches of the mesh. It waits for $3$ values being the $0-based$ of the index of the vertex defined by the <code>mesh</code>.</p>
<h4><a class="anchor" id="autotoc_md38"></a>
Marker</h4>
<p>The marker with a unique name attached to a body segment.</p>
<div class="fragment"><div class="line">marker my_marker</div>
<div class="line">    parent segment_name</div>
<div class="line">    position 0 0 0</div>
<div class="line">    technical 1</div>
<div class="line">    anatomical 0</div>
<div class="line">endmarker</div>
</div><!-- fragment --><p><a class="anchor" id="autotoc_md39"></a></p><h5>parent</h5>
<p>The <code>parent</code> tag is the name of the segment that particular segment is attached to. The parent must be defined earlier in the file and is case dependent. This tag is waits for $1$ string.</p>
<p><a class="anchor" id="autotoc_md40"></a></p><h5>position</h5>
<p>The <code>position</code> of the marker in the local reference frame of the segment.</p>
<p><a class="anchor" id="autotoc_md41"></a></p><h5>technical</h5>
<p>If the marker will be taged as technical (will be returned when asking technical markers). Default value is true ($1$).</p>
<p><a class="anchor" id="autotoc_md42"></a></p><h5>anatomical</h5>
<p>If the marker will be taged as anatomical (will be returned when asking anatomical markers). Default value is false ($0$).</p>
<p><a class="anchor" id="autotoc_md43"></a></p><h5>axestoremove</h5>
<p>It is possible to project the marker onto some axes, if so, write the name of the axes to project onto here. Waits for the axes in a string.</p>
<h4><a class="anchor" id="autotoc_md44"></a>
Imu</h4>
<p>Same as a marker, but for inertial measurement unit. </p><div class="fragment"><div class="line">imu my_imu</div>
<div class="line">    parent segment_parent</div>
<div class="line">    rtinmatrix 0</div>
<div class="line">    rt 0 0 0 xyz 0 0 0</div>
<div class="line">    technical 1</div>
<div class="line">    anatomical 0</div>
<div class="line">endimu</div>
</div><!-- fragment --><p> <a class="anchor" id="autotoc_md45"></a></p><h5>parent</h5>
<p>The <code>parent</code> tag is the name of the segment that particular segment is attached to. The parent must be defined earlier in the file and is case dependent. This tag is waits for $1$ string.</p>
<p><a class="anchor" id="autotoc_md46"></a></p><h5>rt</h5>
<p>The <code>homogeneous matrix</code> of transformation (rototranslation) of the current segment relative to its parent. If <code>rtinmatrix</code> is defined to <code>1</code>, <code>rt</code> waits for a 4 by 4 matrix (the 3 x 3 matrix of rotation and the 4th column being the translation and the last row being 0 0 0 1); if it is defined to <code>0</code> it waits for the 3 rotations, the rotation sequence and the translation. The default value is the identity matrix.</p>
<p><a class="anchor" id="autotoc_md47"></a></p><h5>rtinmatrix</h5>
<p>The tag that defines if the <code>rt</code> is in matrix or not. If the <code>version</code> of the file is higher or equal than $3$, the default value is false ($0$), otherwise, it true ($1$).</p>
<p><a class="anchor" id="autotoc_md48"></a></p><h5>technical</h5>
<p>If the marker will be taged as technical (will be returned when asking technical markers). Default value is true ($1$).</p>
<p><a class="anchor" id="autotoc_md49"></a></p><h5>anatomical</h5>
<p>If the marker will be taged as anatomical (will be returned when asking anatomical markers). Default value is false ($0$).</p>
<h4><a class="anchor" id="autotoc_md50"></a>
Contact</h4>
<p>The position of a non acceleration point while computing the forward dynamics. </p><div class="fragment"><div class="line">contact my_contact</div>
<div class="line">    parent parent_segment</div>
<div class="line">    position 0 0 0</div>
<div class="line">    axis xyz</div>
<div class="line">endcontact</div>
</div><!-- fragment --><p> <a class="anchor" id="autotoc_md51"></a></p><h5>parent</h5>
<p>The <code>parent</code> tag is the name of the segment that particular segment is attached to. The parent must be defined earlier in the file and is case dependent. This tag is waits for $1$ string.</p>
<p><a class="anchor" id="autotoc_md52"></a></p><h5>position</h5>
<p>The <code>position</code> of the marker in the local reference frame of the segment.</p>
<p><a class="anchor" id="autotoc_md53"></a></p><h5>axis</h5>
<p>The name of the <code>axis</code> that the contact acts on. If the version of the file is $1$, this tag has no effect.</p>
<p><a class="anchor" id="autotoc_md54"></a></p><h5>normal</h5>
<p>The <code>normal</code> that the contact acts on. This tags waits for $3$ values with a norm $1$. If the version of the file is not $1$, this tag has no effect. To get the <code>x</code>, <code>y</code> and <code>z</code> axes, one must therefore define three separate contacts.</p>
<p><a class="anchor" id="autotoc_md55"></a></p><h5>acceleration</h5>
<p>The constant <code>acceleration</code> of the contact point. The default values are <code>0, 0, 0</code>.</p>
<h4><a class="anchor" id="autotoc_md56"></a>
Loopconstraint</h4>
<p><a class="anchor" id="autotoc_md57"></a></p><h5></h5>
<h1><a class="anchor" id="autotoc_md58"></a>
How to contribute</h1>
<p>You are very welcome to contribute to the project! There are to main ways to contribute.</p>
<p>The first way is to actually code new features for BIORBD. The easiest way to do so is to fork the project, make the modifications and then open a pull request to the main project. Don't forget to add your name to the contributor in the documentation of the page if you do so!</p>
<p>The second way is to open issues to report bugs or to ask for new features. I am trying to be as reactive as possible, so don't hesitate to do so!</p>
<h1><a class="anchor" id="autotoc_md59"></a>
Graphical User Interface (GUI)</h1>
<p>For now, there is no GUI for the C++ interface and the MATLAB one is so poor I decided not to release it. However, there is a Python interface that worths to have a look at. Installation procedure and documentation can be found at the GitHub repository (<a href="https://github.com/pyomeca/biorbd-viz">https://github.com/pyomeca/biorbd-viz</a>).</p>
<h1><a class="anchor" id="autotoc_md60"></a>
Documentation</h1>
<p>The documentation is not ready yet, but will come soon, when it is ready the next paragraph applies.</p>
<p>The documentation is automatically generated using Doxygen (<a href="http://www.doxygen.org/">http://www.doxygen.org/</a>). You can compile it yourself if you want (by setting <code>BUILD_DOC</code> to <code>ON</code>). Otherwise, you can access a copy of it that I try to keep up-to-date in the Documentation project of pyomeca (<a href="https://pyomeca.github.io/Documentation/">https://pyomeca.github.io/Documentation/</a>) by selecting <code>biorbd</code>.</p>
<h1><a class="anchor" id="autotoc_md61"></a>
Troubleshoots</h1>
<p>Despite my efforts to make a bug-free library, BIORBD may fails sometimes. If it does, please refer to the section below to know what to do. I will fill this section with the issue over time.</p>
<h2><a class="anchor" id="autotoc_md62"></a>
Slow BIORBD</h2>
<p>If you experience a slow BIORBD, you are probably using a non optimized version, that is compiled with <code>debug</code> level. Please use at least <code>RelWithDebInfo</code> level of optimization while compiling BIORBD.</p>
<p>If you actually are using a released level of optimization, you may actually experiencing a bug. You are therefore welcomed to provide me with a minimal example of your slow code and I'll see how to improve the speed!</p>
<h1><a class="anchor" id="autotoc_md63"></a>
Cite</h1>
<p>If you use BIORBD, we would be grateful if you could cite it as follows:</p>
<div class="fragment"><div class="line">@misc{Michaud2018biorbd,</div>
<div class="line">    author = {Michaud, Benjamin and Begon, Mickael},</div>
<div class="line">    title = {BIORBD: Toolbox for biomechanical analyses},</div>
<div class="line">    howpublished={Web page},</div>
<div class="line">    url = {https://github.com/pyomeca/biorbd},</div>
<div class="line">    year = {2018}</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
